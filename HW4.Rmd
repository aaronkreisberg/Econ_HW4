---
title: 'Homework 4: SCC and Climate Policy'
author: "Iris Foxfoot"
date: "5/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(here)
library(tidyverse)
library(patchwork)
```

```{r}
#read in data
damages_data <- read_csv(here("damages.csv"))

warming_data <- read_csv(here("warming.csv"))
```

1. Using damages.csv, estimate a quadratic damage function relating the dollar value of damages to the change in global mean temperature. Omit an intercept term; damages by construction must equal zero when there is no climate change. Plot your estimated damage function, overlaid with a scatterplot of the underlying data.

$$ damages = -3018856250104(warming) + 19589020155100(warming)^2$$
```{r}
#creating vectors of values
damages_data <- damages_data %>% 
  mutate(warming2 = warming^2)

#creating vectors
damages <- damages_data$damages
warming <- damages_data$warming
warming2 <- damages_data$warming2

#estimating quadratic model
damages_quad_model=lm(method = 'lm', damages ~ warming + warming2)

summary(damages_quad_model)

#idk what I'm doing here but the internet says do it
warmingvalues <- seq(0.6900000, 9.243000, 0.1)

#generating predictions
predictedcounts <- predict(damages_quad_model,list(warming=warmingvalues, warming2=warmingvalues^2))

#plotting
plot(warming, damages, pch=16, xlab = "warming (Celsius)", ylab = "damage", cex.lab = 1.3, col = "blue");
lines(warmingvalues, predictedcounts, col = "red", lwd = 3)
```

2. Use warming.csv and your estimated damage function to predict damages in each year under the baseline climate and the pulse scenario. Make four plots: (1) damages over time without the pulse, (2) damages over time with the pulse, (3) the difference in damages over time that arises from the pulse, and (4) the difference in damages over time from the pulse per ton of
CO2 (you can assume that each ton of the pulse causes the same amount of damage).

```{r}
#making a damage function--do it with stored intercepts later
damage_function <- function(x){
  damage <- -3018856250104*x + 19589020155100*x^2
  return(damage)
}

#creating new columns
warming_scenarios <- warming_data %>% 
  mutate(damage_no_pulse = damage_function(warming_baseline)) %>% 
  mutate(damage_with_pulse = damage_function(warming_pulse)) %>% 
  mutate(pulse_damages = damage_with_pulse - damage_no_pulse) %>% 
  mutate(pulse_damages_per_ton = pulse_damages/35)

damage_no_pulse_graph <- ggplot(data = warming_scenarios, aes(x = year, y = damage_no_pulse)) +
  geom_point()

damage_with_pulse_graph <- ggplot(data = warming_scenarios, aes(x = year, y = damage_with_pulse)) +
  geom_point()

pulse_damages_graph <- ggplot(data = warming_scenarios, aes(x = year, y = pulse_damages)) +
  geom_point()

pulse_damages_per_ton_graph <- ggplot(data = warming_scenarios, aes(x = year, y = pulse_damages_per_ton)) +
  geom_point()

(damage_no_pulse_graph + damage_with_pulse_graph)/(pulse_damages_graph + pulse_damages_per_ton_graph)
```

3. The SCC is the present discounted value of the stream of future damages caused by one
additional ton of CO2. The Obama Administration used a discount rate of 3% to discount
damages. Recently, New York State used a discount rate of 2%. Calculate and make a plot of
the SCC (y-axis) against the discount rate (x-axis) for a reasonable range of discount rates.